{"version":3,"file":"compose-DuRHOTJg.js","sources":["../../src/compose.jsx"],"sourcesContent":["import './index.css';\r\nimport './app.css';\r\nimport './polyfills';\r\n\r\nimport { i18n } from '@lingui/core';\r\nimport { t, Trans } from '@lingui/macro';\r\nimport { I18nProvider } from '@lingui/react';\r\nimport { render } from 'preact';\r\nimport { useEffect, useState } from 'preact/hooks';\r\n\r\nimport ComposeSuspense from './components/compose-suspense';\r\nimport Loader from './components/loader';\r\nimport { initActivateLang } from './utils/lang';\r\nimport { initStates } from './utils/states';\r\nimport { getCurrentAccount, setCurrentAccountID } from './utils/store-utils';\r\nimport useTitle from './utils/useTitle';\r\n\r\ninitActivateLang();\r\n\r\nif (window.opener) {\r\n  console = window.opener.console;\r\n}\r\n\r\nfunction App() {\r\n  const [uiState, setUIState] = useState('default');\r\n  const [isLoggedIn, setIsLoggedIn] = useState(null);\r\n\r\n  const { editStatus, replyToStatus, draftStatus } = window.__COMPOSE__ || {};\r\n\r\n  useTitle(\r\n    editStatus\r\n      ? t`Editing source status`\r\n      : replyToStatus\r\n        ? t`Replying to @${\r\n            replyToStatus.account?.acct || replyToStatus.account?.username\r\n          }`\r\n        : t`Compose`,\r\n  );\r\n\r\n  useEffect(() => {\r\n    const account = getCurrentAccount();\r\n    setIsLoggedIn(!!account);\r\n    if (account) {\r\n      initStates();\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (uiState === 'closed') {\r\n      try {\r\n        // Focus parent window\r\n        window.opener.focus();\r\n      } catch (e) {}\r\n      window.close();\r\n    }\r\n  }, [uiState]);\r\n\r\n  if (uiState === 'closed') {\r\n    return (\r\n      <div class=\"box\">\r\n        <p>\r\n          <Trans>You may close this page now.</Trans>\r\n        </p>\r\n        <p>\r\n          <button\r\n            onClick={() => {\r\n              window.close();\r\n            }}\r\n          >\r\n            <Trans>Close window</Trans>\r\n          </button>\r\n        </p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  console.debug('OPEN COMPOSE');\r\n\r\n  if (isLoggedIn === false) {\r\n    return (\r\n      <div class=\"box\">\r\n        <h1>\r\n          <Trans>Error</Trans>\r\n        </h1>\r\n        <p>\r\n          <Trans>Login required.</Trans>\r\n        </p>\r\n        <p>\r\n          <a href=\"/\">\r\n            <Trans>Go home</Trans>\r\n          </a>\r\n        </p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (isLoggedIn) {\r\n    return (\r\n      <ComposeSuspense\r\n        editStatus={editStatus}\r\n        replyToStatus={replyToStatus}\r\n        draftStatus={draftStatus}\r\n        standalone\r\n        hasOpener={window.opener}\r\n        onClose={(results) => {\r\n          const { newStatus, fn = () => {} } = results || {};\r\n          try {\r\n            if (newStatus) {\r\n              window.opener.__STATES__.reloadStatusPage++;\r\n            }\r\n            fn();\r\n            setUIState('closed');\r\n          } catch (e) {}\r\n        }}\r\n      />\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div class=\"box\">\r\n      <Loader />\r\n    </div>\r\n  );\r\n}\r\n\r\nrender(\r\n  <I18nProvider i18n={i18n}>\r\n    <App />\r\n  </I18nProvider>,\r\n  document.getElementById('app-standalone'),\r\n);\r\n"],"names":["initActivateLang","window","opener","console","App","uiState","setUIState","useState","isLoggedIn","setIsLoggedIn","editStatus","replyToStatus","draftStatus","__COMPOSE__","useTitle","i18n","_","id","values","0","account","acct","username","useEffect","getCurrentAccount","initStates","focus","close","_jsxs","class","children","_jsx","Trans","onClick","href","ComposeSuspense","standalone","hasOpener","newStatus","results","fn","Loader","render","I18nProvider"],"mappings":"mIAiBAA,IAEIC,OAAOC,SACTC,QAAUF,OAAOC,OAAOC,SAG1B,SAASC,GAAM,SACb,KAAM,CAACC,EAASC,CAAU,EAAIC,EAAS,SAAS,EAC1C,CAACC,EAAYC,CAAa,EAAIF,EAAS,IAAI,EAE3C,CAAEG,WAAAA,EAAYC,cAAAA,EAAeC,YAAAA,CAAAA,EAAgBX,OAAOY,aAAe,GA8BzE,OA5BAC,EACEJ,EAAUK,EAAAC,EACN,CAAAC,GAAA,QAAuB,CAAA,EACvBN,EAAaI,EAAAC,EACX,CAAAC,GAAA,SAAAC,OAAA,CAAAC,IACER,EAAAA,EAAcS,UAAdT,YAAAA,EAAuBU,SAAQV,EAAAA,EAAcS,UAAdT,YAAAA,EAAuBW,SAAQ,CAC/D,GAACP,EAAAC,EACF,CAAAC,GAAA,QAAS,CAAA,CACjB,EAEAM,EAAU,IAAM,CACd,MAAMH,EAAUI,IACFf,EAAA,CAAC,CAACW,CAAO,EACnBA,GACSK,GAEf,EAAG,CAAE,CAAA,EAELF,EAAU,IAAM,CACd,GAAIlB,IAAY,SAAU,CACpB,GAAA,CAEFJ,OAAOC,OAAOwB,aACJ,CAAC,CACbzB,OAAO0B,MAAM,CACf,CAAA,EACC,CAACtB,CAAO,CAAC,EAERA,IAAY,SAEZuB,EAAA,MAAA,CAAKC,MAAM,MAAKC,UACdC,EAAA,IAAA,CAAAD,SACEC,EAAAC,EAAA,CAAAf,GAAA,QAAA,CAA0C,CAAA,CACzC,EACHc,EAAA,IAAA,CAAAD,SACEC,EAAA,SAAA,CACEE,QAASA,IAAM,CACbhC,OAAO0B,MAAM,CACf,EAAEG,SAEFC,EAAAC,EAAA,CAAAf,GAAA,QAAA,CAA0B,CAAA,CACpB,CAAA,CACP,CAAC,CAAA,CACD,EAITd,IAA4B,WAEF,CACxB,YACO0B,SAAM,CAAAE,EAAA,KAAA,CAAKD,SACdC,EAAAC,EAAA,CAAAF,GAAAA,QACE,CAAA,CAAA,CAAA,EAAmBC,EAAA,IAAA,CAErBA,SAAAA,EAAAC,EAAA,CAAAF,GAAAA,QACE,CAAA,CAAA,CAAA,EAA6BC,EAAA,IAAA,CAE/BA,SAAAA,EAAA,IAAA,CAAAD,KAAAA,IACKI,SAAKH,EAAAC,EAAA,CAAGF,GAAAA,QACT,CAAA,CAAA,CAAA,CAAqB,CAAA,CAAC,CACrB,CAAA,EAIXtB,EAEgBuB,EAAAI,EAAA,CACd,WAAAzB,EAEIA,cAAAA,EACAC,YAAAA,EACAC,WAAAA,GACAwB,UAAU,OAAA,OACVC,WAAkBnC,OAEV,UAAAoC,EAAEA,GAAAA,EAAAA,IAAAA,EAAsB,EAACC,GAAA,CAAA,EAAE,GAAIA,CACjCD,GACF,OAAe,OAAA,WAAA,mBAEfE,IACGlC,EAAA,QAAA,CACHA,MAAAA,EACW,CAAA,CACf,EAGNyB,EAAA,MAAA,CAEA,YACOF,SAAME,EAAAU,EAAA,EAAA,CAAA,CAAA,CACA,CAGfC,EAAAX,EAAAY,EAAA,CAEAD,KAAAA,EACgB3B,SAAAA,EAAAA,EAAAA,EAAAA,CAAAA,CAAAA,EACZgB,SAAAA,eAAM,gBAAA,CAAA"}